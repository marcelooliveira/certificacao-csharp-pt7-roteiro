Evitando Repetição de Expressões
==================================

Suponha que você tenha desenvolvido a seguinte consulta Linq:

```
var query =
    from inf in contexto.ItemsNotaFiscal
    where inf.Faixa.Album.Artista.Nome == "Led Zeppelin"
    group inf by inf.Faixa.Album into agrupado
    orderby agrupado.Sum(a => a.PrecoUnitario * a.Quantidade) descending
    select new
    {
        Album = agrupado.Key.Titulo,
        Valor = agrupado.Sum(a => a.PrecoUnitario * a.Quantidade),
        NumeroVendas = agrupado.Count()
    };
```

Essa consulta funciona perfeitamente, porém uma programadora da sua equipe notou que a expressão `agrupado.Sum(a => a.PrecoUnitario * a.Quantidade)` está repetida em dois lugares da sua consulta. O que você faria para eliminar essa repetição?

### Opinião do instrutor

Para refatorar a consulta acima, basta usar a cláusula let para armazenar a expressão `agrupado.Sum(a => a.PrecoUnitario * a.Quantidade)` numa variável de alcance `valorTotal`, e substituir a expressão repetida por essa variável:

```
var query =
    from inf in contexto.ItemsNotaFiscal
    where inf.Faixa.Album.Artista.Nome == "Led Zeppelin"
    group inf by inf.Faixa.Album into agrupado
    let valorTotal = agrupado.Sum(a => a.PrecoUnitario * a.Quantidade)
    orderby valorTotal descending
    select new
    {
        Album = agrupado.Key.Titulo,
        Valor = valorTotal,
        NumeroVendas = agrupado.Count()
    };
```